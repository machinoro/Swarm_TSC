<?xml version="1.0" encoding="UTF-8"?>
<robot name="wheel" xmlns:xacro="https://www.ros.org/wiki/xacro">
  <xacro:macro name="roller_origin" params="th side">
    <xacro:if value="${side==1}">
      <origin rpy="${atan(-tan(th)*sqrt(2.0))} ${asin(cos(th)/sqrt(2.0))} ${atan(sin(th))}" xyz="0 ${0.05*cos(th)} ${0.05*sin(th)}"></origin>
    </xacro:if>
    <xacro:if value="${side==-1}">
      <origin rpy="${atan(-tan(th)*sqrt(2.0))} ${asin(-cos(th)/sqrt(2.0))} ${atan(-sin(th))}" xyz="0 ${0.05*cos(th)} ${0.05*sin(th)}"></origin>
    </xacro:if>
  </xacro:macro>
  <xacro:macro name="roller_loop" params="name side num loop">
    <xacro:if value="${loop}">
      <link name="${name}_roller${loop}_link">
        <visual>
          <origin rpy="0 0 0" xyz="0 0 0"></origin>
          <geometry>
            <mesh filename="package://ugv/meshes/visual/roller.dae" scale="1 1 1"></mesh>
          </geometry>
        </visual>
        <collision>
          <geometry>
            <mesh filename="package://ugv/meshes/collision/roller.stl" scale="1 1 1"></mesh>
          </geometry>
        </collision>
        <inertial>
          <origin xyz="0 0 0"></origin>
          <mass value="0.3"></mass>
          <inertia ixx="0.00024000" ixy="0.0" ixz="0.0" iyy="0.00076000" iyz="0.0" izz="0.00076000"></inertia>
        </inertial>
      </link>
      <joint name="${name}_roller${loop}_joint" type="continuous">
        <xacro:roller_origin side="${side}" th="${radians(360/num*(loop-1))}"></xacro:roller_origin>
        <axis xyz="1 0 0"></axis>
        <parent link="${name}_wheel_link"></parent>
        <child link="${name}_roller${loop}_link"></child>
        <dynamics damping="0.001" friction="0.0001"></dynamics>
      </joint>
      <!-- <transmission name="$${name}_roller${loop}_trans"> -->
      <!--   <type>transmission_interface/SimpleTransmission</type> -->
      <!--   <joint name="${name}_roller${loop}_joint"> -->
      <!--     <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface> -->
      <!--   </joint> -->
      <!--   <actuator name="${name}_roller${loop}_motor"> -->
      <!--     <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface> -->
      <!--     <mechanismReduction>1</mechanismReduction> -->
      <!--   </actuator> -->
      <!-- </transmission> -->
      <gazebo reference="${name}_roller${loop}_link">
        <mu1>0.8</mu1>
        <mu2>0.8</mu2>
        <kp>10000000.0</kp>
        <kd>1.0</kd>
        <fdir1>0 1 0</fdir1>
      </gazebo>
      <xacro:roller_loop loop="${loop - 1}" name="${name}" num="${num}" side="${side}"></xacro:roller_loop>
    </xacro:if>
  </xacro:macro>
  <xacro:macro name="rollers_link" params="name side">
    <xacro:roller_loop loop="9" name="${name}" num="9" side="${side}"></xacro:roller_loop>
  </xacro:macro>
</robot>
